<!-- AI è¿ç»´ Tab -->
<div class="tab-panel space-y-4" data-tab="ops">
  <!-- è¯´æ˜ -->
  <div class="glass rounded-2xl p-5">
    <div class="flex items-center justify-between mb-3">
      <h3 class="text-white text-sm font-medium">ğŸ¤– AI è¿ç»´</h3>
      <span class="text-[11px] px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-300">ç”± OpenClaw ç›´æ¥ç®¡ç†</span>
    </div>
    <p class="text-gray-500 text-xs leading-relaxed">
      AI è¿ç»´ç”±æœ¬æœº OpenClaw ç›´æ¥æ“ä½œï¼ˆè¯»æ•°æ®åº“ã€ç®¡è¿›ç¨‹ã€SSH èŠ‚ç‚¹ï¼‰ï¼Œæ— éœ€ API ä¸­é—´å±‚ã€‚
      ä»¥ä¸‹é…ç½®æ§åˆ¶ AI çš„è‡ªåŠ¨åŒ–è¡Œä¸ºã€‚
    </p>
  </div>

  <!-- è¿ç»´é…ç½® -->
  <div class="glass rounded-2xl p-5">
    <h3 class="text-white text-sm font-medium mb-4">âš™ï¸ è¿ç»´é…ç½®</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="text-gray-500 text-xs block mb-1">ç›®æ ‡èŠ‚ç‚¹æ•°ï¼ˆ0=ä¸è‡ªåŠ¨æ‰©ç¼©å®¹ï¼‰</label>
        <input type="number" id="ops-target-nodes" min="0" class="w-full bg-black/30 text-white px-3 py-2 rounded-xl border border-white/10 text-sm" value="0">
      </div>
      <div>
        <label class="text-gray-500 text-xs block mb-1">å·¡æ£€é—´éš”ï¼ˆåˆ†é’Ÿï¼‰</label>
        <input type="number" id="ops-patrol-interval" min="5" class="w-full bg-black/30 text-white px-3 py-2 rounded-xl border border-white/10 text-sm" value="30">
      </div>
      <div>
        <label class="text-gray-500 text-xs block mb-1">æ¯æ—¥æ¢ IP ä¸Šé™</label>
        <input type="number" id="ops-max-daily-swaps" min="0" class="w-full bg-black/30 text-white px-3 py-2 rounded-xl border border-white/10 text-sm" value="10">
      </div>
      <div>
        <label class="text-gray-500 text-xs block mb-1">æ¯æ—¥åˆ›å»ºå®ä¾‹ä¸Šé™</label>
        <input type="number" id="ops-max-daily-creates" min="0" class="w-full bg-black/30 text-white px-3 py-2 rounded-xl border border-white/10 text-sm" value="3">
      </div>
    </div>

    <div class="mt-4 space-y-2">
      <label class="flex items-center justify-between p-3 rounded-xl bg-black/20 cursor-pointer hover:bg-white/5 transition">
        <div><span class="text-white text-sm">ğŸ”„ è¢«å¢™è‡ªåŠ¨æ¢ IP</span><span class="text-gray-600 text-xs ml-2">æ£€æµ‹åˆ°è¢«å¢™æ—¶è‡ªåŠ¨æ¢ IP</span></div>
        <input type="checkbox" id="ops-auto-swap-ip" class="accent-rose-500">
      </label>
      <label class="flex items-center justify-between p-3 rounded-xl bg-black/20 cursor-pointer hover:bg-white/5 transition">
        <div><span class="text-white text-sm">ğŸ”§ èŠ‚ç‚¹è‡ªåŠ¨ä¿®å¤</span><span class="text-gray-600 text-xs ml-2">xray å¼‚å¸¸æ—¶è‡ªåŠ¨é‡å¯</span></div>
        <input type="checkbox" id="ops-auto-repair" class="accent-rose-500">
      </label>
      <label class="flex items-center justify-between p-3 rounded-xl bg-black/20 cursor-pointer hover:bg-white/5 transition">
        <div><span class="text-white text-sm">ğŸ“ˆ è‡ªåŠ¨æ‰©ç¼©å®¹</span><span class="text-gray-600 text-xs ml-2">èŠ‚ç‚¹ä¸è¶³æ—¶è‡ªåŠ¨åˆ›å»ºæ–°å®ä¾‹</span></div>
        <input type="checkbox" id="ops-auto-scale" class="accent-rose-500">
      </label>
      <label class="flex items-center justify-between p-3 rounded-xl bg-black/20 cursor-pointer hover:bg-white/5 transition">
        <div><span class="text-white text-sm">ğŸ›¡ï¸ é¢æ¿å®ˆæŠ¤</span><span class="text-gray-600 text-xs ml-2">é¢æ¿æŒ‚äº†è‡ªåŠ¨é‡å¯</span></div>
        <input type="checkbox" id="ops-panel-guard" class="accent-rose-500">
      </label>
    </div>

    <button onclick="saveOpsConfig()" class="mt-4 w-full bg-rose-600 hover:bg-rose-500 text-white py-2 rounded-xl text-sm transition">ä¿å­˜é…ç½®</button>
  </div>

  <!-- æœ€è¿‘è¿ç»´æ—¥å¿— -->
  <div class="glass rounded-2xl p-5">
    <h3 class="text-white text-sm font-medium mb-3">ğŸ“‹ æœ€è¿‘è¿ç»´æ—¥å¿—</h3>
    <div class="overflow-x-auto max-h-[300px] overflow-y-auto" id="ops-logs-container">
      <p class="text-gray-600 text-xs text-center py-4">åˆ‡æ¢åˆ°æ­¤ Tab æ—¶åŠ è½½</p>
    </div>
  </div>
</div>

<script>
// ========== AI è¿ç»´é…ç½® ==========
(function() {
  // é…ç½® key æ˜ å°„
  const OPS_KEYS = [
    { id: 'ops-target-nodes', key: 'ops_target_nodes', type: 'int' },
    { id: 'ops-patrol-interval', key: 'ops_patrol_interval', type: 'int' },
    { id: 'ops-max-daily-swaps', key: 'ops_max_daily_swaps', type: 'int' },
    { id: 'ops-max-daily-creates', key: 'ops_max_daily_creates', type: 'int' },
    { id: 'ops-auto-swap-ip', key: 'ops_auto_swap_ip', type: 'bool' },
    { id: 'ops-auto-repair', key: 'ops_auto_repair', type: 'bool' },
    { id: 'ops-auto-scale', key: 'ops_auto_scale', type: 'bool' },
    { id: 'ops-panel-guard', key: 'ops_panel_guard', type: 'bool' },
  ];

  window.loadOpsConfig = async function() {
    try {
      const res = await fetch('/admin/api/ops-config');
      const cfg = await res.json();
      for (const k of OPS_KEYS) {
        const el = document.getElementById(k.id);
        if (!el) continue;
        const val = cfg[k.key];
        if (k.type === 'bool') el.checked = val === 'true';
        else if (val) el.value = val;
      }
    } catch {}

    // è¿ç»´æ—¥å¿—
    const container = document.getElementById('ops-logs-container');
    try {
      const res2 = await fetch('/admin/api/logs?page=1&type=system');
      const d = await res2.json();
      const opsKeywords = ['ops_', 'swap_ip', 'deploy', 'repair', 'node_', 'aws_', 'rotate', 'health'];
      const opsLogs = (d.rows || []).filter(l => l.action && opsKeywords.some(kw => l.action.includes(kw)));
      if (opsLogs.length === 0) {
        container.innerHTML = '<p class="text-gray-600 text-xs text-center py-4">æš‚æ— è¿ç»´æ—¥å¿—</p>';
      } else {
        container.innerHTML = '<table class="w-full text-sm text-left"><thead class="text-gray-500 border-b border-white/5 text-xs sticky top-0" style="background:rgba(15,11,30,0.95)"><tr><th class="py-2 px-3">æ—¶é—´</th><th class="py-2 px-3">æ“ä½œ</th><th class="py-2 px-3">è¯¦æƒ…</th></tr></thead><tbody class="text-gray-300">' +
          opsLogs.slice(0, 20).map(l => `<tr class="border-b border-white/5"><td class="py-1.5 px-3 text-[11px] text-gray-500">${l.created_at}</td><td class="py-1.5 px-3 text-[11px]">${l.action}</td><td class="py-1.5 px-3 text-[11px] text-gray-500 max-w-xs truncate">${l.detail || ''}</td></tr>`).join('') +
          '</tbody></table>';
      }
    } catch {
      container.innerHTML = '<p class="text-gray-600 text-xs text-center py-4">æš‚æ— è¿ç»´æ—¥å¿—</p>';
    }
  };

  window.saveOpsConfig = async function() {
    const data = {};
    for (const k of OPS_KEYS) {
      const el = document.getElementById(k.id);
      if (!el) continue;
      data[k.key] = k.type === 'bool' ? String(el.checked) : el.value;
    }
    try {
      const res = await fetch('/admin/api/ops-config', {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      if (res.ok) showToast('âœ… è¿ç»´é…ç½®å·²ä¿å­˜');
      else showToast('âŒ ä¿å­˜å¤±è´¥');
    } catch (e) { showToast('âŒ ' + e.message); }
  };
})();
if (location.hash === '#ops') setTimeout(loadOpsConfig, 100);
</script>
